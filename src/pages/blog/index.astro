---
import Base from '../../layouts/Base.astro';
import { fetchDrupalPosts, type DrupalPost } from '../../lib/drupal';

// SEO and meta data
const title = "Codariq Blog: Automatisierung für Selbstständige und kleine Teams";
const description = "Praxisnahe Artikel zu Automatisierung, Datenschutz und Projektrettung, damit du weniger Routinearbeit hast und mehr Zeit für dein Kerngeschäft gewinnst.";
const keywords = "Prozesse automatisieren, Workflow automatisieren, Automatisierung für Selbstständige, Prozessautomatisierung KMU, E Mail automatisieren, Dokumente automatisieren, Rechnungen automatisieren, Lead Follow up automatisieren, Recruiting automatisieren, DSGVO konforme Automatisierung";
const author = "Codariq Research Team";
const publishedTime = "2026-01-02T10:00:00+01:00";
const image = "/images/hero/hero2.webp";

const drupalPosts: DrupalPost[] = await fetchDrupalPosts(6);

const formatDate = (value?: string) => {
  if (!value) return "";
  const d = new Date(value);
  return d.toLocaleDateString("de-DE", {
    day: "numeric",
    month: "long",
    year: "numeric",
  });
};

const formatCategory = (value: string | string[] | undefined) => {
  if (!value) return "Blog";
  let first: string =
    Array.isArray(value) && value.length > 0
      ? value[0] as string
      : (value as string);

  if (typeof first === "object" && first !== null) {
    // Drupal list items can come back as objects; try common props
    // @ts-ignore
    first = first.value || first.name || String(first);
  }

  const cleaned = String(first).trim();
  if (!cleaned) return "Blog";
  return cleaned.charAt(0).toUpperCase() + cleaned.slice(1);
};
---

<Base
  title={title}
  description={description}
  keywords={keywords}
  ogImage={image}
  forceNavSolid={true}
>

<!-- Breadcrumb Navigation -->
<nav aria-label="Breadcrumb" class="bg-gray-50 py-3 pt-16 sm:pt-20">
  <div class="max-w-4xl mx-auto px-4">
    <ol class="flex items-center space-x-2 text-sm">
      <li><a href="/" class="text-gray-600 hover:text-orange-600">Startseite</a></li>
      <li class="text-gray-400">/</li>
      <li class="text-gray-900 font-medium">Blog</li>
    </ol>
  </div>
</nav>

<!-- Blog Header -->
<header class="bg-gradient-to-r from-orange-50 to-orange-100 py-12 sm:py-16">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center">

      <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-gray-900 mb-6 leading-tight">
        Automatisierung, die dir <span class="text-orange-600">Routinearbeit abnimmt</span>
      </h1>

      <p class="text-lg sm:text-xl text-gray-700 max-w-3xl mx-auto leading-relaxed mb-8">
        {description}
      </p>

      <div class="flex items-center justify-center gap-4 text-sm text-gray-600">
        <span class="flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
          </svg>
          {author}
        </span>
      </div>
    </div>
  </div>
</header>

<!-- Blog Posts Grid -->
<section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
  <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">

        <!-- Blog Post 1 - Project Rescue -->
        <article class="bg-white rounded-xl border border-gray-200 overflow-hidden hover:shadow-lg transition-all duration-300 group">
          <a href="/blog/ki-projekte-retten" class="block">
            <div class="p-6">
              <div class="mb-4">
                <div class="w-full h-32 bg-gradient-to-br from-red-100 to-orange-200 rounded-lg flex items-center justify-center mb-4">
                  <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                  </svg>
                </div>
                <span class="text-xs font-medium text-red-600 bg-red-50 px-2 py-1 rounded">
                  Projektrettung
                </span>
              </div>
              <h2 class="text-lg font-semibold text-gray-900 mb-3 group-hover:text-red-600 transition-colors line-clamp-2">
                KI Projekt retten: 3 Praxisbeispiele, wie es wieder stabil läuft
              </h2>
              <p class="text-gray-600 text-sm leading-relaxed mb-4 line-clamp-3">
                Wenn Automatisierung im Alltag nicht stabil läuft: typische Ursachen, schnelle Checks und ein klarer Plan, damit es genutzt wird.
              </p>
              <div class="flex items-center justify-between text-xs text-gray-500">
                <span>10 Min. Lesezeit</span>
                <span>9. Januar 2025</span>
              </div>
            </div>
          </a>
        </article>

        <!-- Blog Post 2 - Compliance Blog -->
        <article class="bg-white rounded-xl border border-gray-200 overflow-hidden hover:shadow-lg transition-all duration-300 group">
          <a href="/blog/ki-compliance-2025" class="block">
            <div class="p-6">
              <div class="mb-4">
                <div class="w-full h-32 bg-gradient-to-br from-orange-100 to-orange-200 rounded-lg flex items-center justify-center mb-4">
                  <svg class="w-8 h-8 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                </div>
                <span class="text-xs font-medium text-orange-600 bg-orange-50 px-2 py-1 rounded">
                  KI-Compliance
                </span>
              </div>
              <h2 class="text-lg font-semibold text-gray-900 mb-3 group-hover:text-orange-600 transition-colors line-clamp-2">
                KI und Datenschutz in Deutschland: das Wichtigste ohne Juristendeutsch
              </h2>
              <p class="text-gray-600 text-sm leading-relaxed mb-4 line-clamp-3">
                DSGVO, AVV, Hosting und Zugriffsschutz, kurz und verständlich. Damit du weißt, worauf es vor dem Start wirklich ankommt.
              </p>
              <div class="flex items-center justify-between text-xs text-gray-500">
                <span>15 Min. Lesezeit</span>
                <span>15. Januar 2025</span>
              </div>
            </div>
          </a>
        </article>

        <!-- Blog Post 2 -->
        <article class="bg-white rounded-xl border border-gray-200 overflow-hidden hover:shadow-lg transition-all duration-300 group">
          <a href="/blog/ki-integration-5-schritte" class="block">
            <div class="p-6">
              <div class="mb-4">
                <div class="w-full h-32 bg-gradient-to-br from-orange-100 to-orange-200 rounded-lg flex items-center justify-center mb-4">
                  <svg class="w-8 h-8 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                  </svg>
                </div>
                <span class="text-xs font-medium text-orange-600 bg-orange-50 px-2 py-1 rounded">
                  Einstieg
                </span>
              </div>
              <h2 class="text-lg font-semibold text-gray-900 mb-3 group-hover:text-orange-600 transition-colors line-clamp-2">
                Automatisierung starten in 5 Schritten
              </h2>
              <p class="text-gray-600 text-sm leading-relaxed mb-4 line-clamp-3">
                Ein klarer Ablauf für den Einstieg, ohne Tool Chaos. Du siehst, wie du den richtigen Startpunkt wählst und Fortschritt messbar machst.
              </p>
              <div class="flex items-center justify-between text-xs text-gray-500">
                <span>8 Min. Lesezeit</span>
                <span>15. Dezember 2024</span>
              </div>
            </div>
          </a>
        </article>

    <!-- Blog Post 3 -->
    <article class="bg-white rounded-xl border border-gray-200 overflow-hidden hover:shadow-lg transition-all duration-300 group">
      <a href="/blog/automatisierung-roi-maximieren" class="block">
        <div class="p-6">
          <div class="mb-4">
            <div class="w-full h-32 bg-gradient-to-br from-blue-100 to-blue-200 rounded-lg flex items-center justify-center mb-4">
              <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
              </svg>
            </div>
            <span class="text-xs font-medium text-blue-600 bg-blue-50 px-2 py-1 rounded">
              Automatisierung
            </span>
          </div>
          <h2 class="text-lg font-semibold text-gray-900 mb-3 group-hover:text-blue-600 transition-colors line-clamp-2">
            ROI von Prozessautomatisierung: So rechnet es sich
          </h2>
          <p class="text-gray-600 text-sm leading-relaxed mb-4 line-clamp-3">
            Eine einfache Rechenlogik, um zu entscheiden, ob sich ein Ablauf lohnt. Mit Beispielen aus E Mails, Dokumenten, Leads und Recruiting.
          </p>
          <div class="flex items-center justify-between text-xs text-gray-500">
            <span>12 Min. Lesezeit</span>
            <span>2. Januar 2026</span>
          </div>
        </div>
      </a>
    </article>

    <!-- Blog Post 4 -->
        <article class="bg-white rounded-xl border border-gray-200 overflow-hidden hover:shadow-lg transition-all duration-300 group">
          <a href="/blog/ki-teams-vorbereiten" class="block">
            <div class="p-6">
              <div class="mb-4">
                <div class="w-full h-32 bg-gradient-to-br from-green-100 to-green-200 rounded-lg flex items-center justify-center mb-4">
              <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
              </svg>
            </div>
            <span class="text-xs font-medium text-green-600 bg-green-50 px-2 py-1 rounded">
              Alltag
            </span>
          </div>
          <h2 class="text-lg font-semibold text-gray-900 mb-3 group-hover:text-green-600 transition-colors line-clamp-2">
            Teams und Abläufe so vorbereiten, dass es genutzt wird
          </h2>
          <p class="text-gray-600 text-sm leading-relaxed mb-4 line-clamp-3">
            Technik allein reicht nicht. So bringst du Automatisierung in deinen Alltag, ohne dass sie umgangen wird oder nebenher ausstirbt.
          </p>
          <div class="flex items-center justify-between text-xs text-gray-500">
            <span>10 Min. Lesezeit</span>
            <span>15. Dezember 2024</span>
          </div>
        </div>
      </a>
        </article>

        {
          drupalPosts.map((post) => {
            const displayCategory = formatCategory(post.category);
            const rawSummary = post.summary || post.body || "";
            const summaryText = rawSummary
              .replace(/<[^>]+>/g, " ")
              .replace(/\s+/g, " ")
              .trim()
              .slice(0, 140);
            return (
              <article class="bg-white rounded-xl border border-gray-200 overflow-hidden hover:shadow-lg transition-all duration-300 group">
                <a href={`/blog/${post.slug}`} class="block">
                  <div class="p-6">
                    <div class="mb-4">
                      <div class="w-full h-32 rounded-lg overflow-hidden mb-4 bg-gradient-to-br from-orange-100 to-orange-200 flex items-center justify-center">
                        {
                          post.coverUrl ? (
                            <img
                              src={post.coverUrl}
                              alt={post.title}
                              class="w-full h-full object-cover"
                              loading="lazy"
                              decoding="async"
                            />
                          ) : (
                            <svg
                              class="w-8 h-8 text-orange-600"
                              fill="none"
                              stroke="currentColor"
                              viewBox="0 0 24 24"
                            >
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                          )
                        }
                      </div>
                      <span class="text-xs font-medium text-orange-600 bg-orange-50 px-2 py-1 rounded">
                        {displayCategory}
                      </span>
                    </div>
                    <h4 class="text-lg font-semibold text-gray-900 mb-2 group-hover:text-orange-600 transition-colors">
                      {post.title}
                    </h4>
                    <p class="text-gray-600 text-sm leading-relaxed mb-4 line-clamp-3">
                      {summaryText}
                    </p>
                    <div class="flex items-center justify-between text-xs text-gray-500">
                      <span>
                        {post.readTime ? `${post.readTime} Min. Lesezeit` : ""}
                      </span>
                      <span>{formatDate(post.date)}</span>
                    </div>
                  </div>
                </a>
              </article>
            );
          })
        }

      </div>

  <!-- Newsletter CTA -->
  <div class="mt-16 bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl p-8 text-center">
    <h3 class="text-2xl font-bold text-gray-900 mb-4">
      Mehr Praxiswissen erhalten
    </h3>
    <p class="text-gray-700 mb-6 max-w-2xl mx-auto">
      Hol dir ab und zu einen kurzen Impuls: konkrete Beispiele, klare Abläufe und Dinge, die dir wirklich Zeit sparen.
    </p>
    <!-- Newsletter Form -->
    <form id="blog-newsletter-form" class="max-w-md mx-auto flex gap-3">
      <div class="flex-1">
        <label for="blog-newsletter-email" class="sr-only">E-Mail-Adresse</label>
        <input
          type="email"
          id="blog-newsletter-email"
          name="email"
          required
          autocomplete="email"
          placeholder="E-Mail"
          class="w-full px-4 py-3 border border-gray-300 bg-white text-gray-900 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all text-sm placeholder-gray-500"
        />
      </div>
      <button
        type="submit"
        class="bg-gradient-to-br from-orange-500 to-orange-700 text-white px-6 py-3 rounded-lg hover:from-orange-600 hover:to-orange-800 font-medium text-sm transition-all duration-200 cta-button whitespace-nowrap"
      >
        Abonnieren
      </button>
    </form>

    <!-- Success Message -->
    <div id="blog-newsletter-success" class="hidden mt-4 p-4 bg-green-50 border border-green-200 rounded-lg max-w-md mx-auto">
      <div class="flex items-center gap-2">
        <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
        </svg>
        <div>
          <p class="font-medium text-green-800 text-sm">Erfolgreich angemeldet!</p>
          <p class="text-green-700 text-xs">Du erhältst eine Bestätigungs E Mail</p>
        </div>
      </div>
    </div>

    <!-- Error Message -->
    <div id="blog-newsletter-error" class="hidden mt-4 p-4 bg-red-50 border border-red-200 rounded-lg max-w-md mx-auto">
      <p class="text-red-800 text-sm">Ein Fehler ist aufgetreten. Bitte versuchen Sie es später erneut.</p>
    </div>
  </div>
</section>

<!-- Categories Section
<section class="bg-gray-50 py-12">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
    <h3 class="text-2xl font-bold text-gray-900 mb-8">Entdecken Sie mehr Themen</h3>
    <div class="grid md:grid-cols-3 gap-6">
      <div class="bg-white rounded-lg p-6 border border-gray-200">
        <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
          </svg>
        </div>
        <h4 class="font-semibold text-gray-900 mb-2">KI-Strategie</h4>
        <p class="text-gray-600 text-sm">Strategische KI-Implementierung und langfristige Planung</p>
      </div>

      <div class="bg-white rounded-lg p-6 border border-gray-200">
        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
          </svg>
        </div>
        <h4 class="font-semibold text-gray-900 mb-2">Automatisierung</h4>
        <p class="text-gray-600 text-sm">Prozessoptimierung und Workflow-Automatisierung</p>
      </div>

      <div class="bg-white rounded-lg p-6 border border-gray-200">
        <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
          </svg>
        </div>
        <h4 class="font-semibold text-gray-900 mb-2">Change Management</h4>
        <p class="text-gray-600 text-sm">Mitarbeiterführung und kultureller Wandel</p>
      </div>
    </div>
  </div>
</section> -->

</Base>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const blogNewsletterForm = document.getElementById('blog-newsletter-form');
    const blogNewsletterSuccess = document.getElementById('blog-newsletter-success');
    const blogNewsletterError = document.getElementById('blog-newsletter-error');

    if (blogNewsletterForm) {
      blogNewsletterForm.addEventListener('submit', async function(e) {
        e.preventDefault();

        const emailInput = document.getElementById('blog-newsletter-email');
        const submitButton = blogNewsletterForm.querySelector('button[type="submit"]');
        const email = emailInput.value.trim();

        // Hide previous messages
        if (blogNewsletterSuccess) blogNewsletterSuccess.classList.add('hidden');
        if (blogNewsletterError) blogNewsletterError.classList.add('hidden');

        // Validate email
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!email || !emailRegex.test(email)) {
          if (blogNewsletterError) {
            blogNewsletterError.querySelector('p').textContent = 'Bitte gib eine gültige E Mail Adresse ein.';
            blogNewsletterError.classList.remove('hidden');
          }
          return;
        }

        // Set loading state
        if (submitButton) {
          submitButton.disabled = true;
          submitButton.textContent = 'Wird gesendet...';
        }

        try {
          // Send to newsletter API endpoint
          const response = await fetch('/api/newsletter', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              email: email,
              source: 'blog_newsletter',
              timestamp: new Date().toISOString(),
              userAgent: navigator.userAgent
            })
          });

          if (response.ok) {
            // Show success message
            if (blogNewsletterSuccess) {
              blogNewsletterSuccess.classList.remove('hidden');
              blogNewsletterForm.style.display = 'none';
            }
          } else {
            throw new Error('Newsletter-Anmeldung fehlgeschlagen');
          }

        } catch (error) {
          console.error('Newsletter subscription error:', error);
          if (blogNewsletterError) {
            blogNewsletterError.querySelector('p').textContent = 'Ein Fehler ist aufgetreten. Bitte versuchen Sie es später erneut.';
            blogNewsletterError.classList.remove('hidden');
          }
        } finally {
          // Reset loading state
          if (submitButton) {
            submitButton.disabled = false;
            submitButton.textContent = 'Abonnieren';
          }
        }
      });
    }
  });
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Blog",
  "name": "Codariq Blog",
  "description": "Praxisnahe Artikel zu Automatisierung, Datenschutz und Projektrettung für Selbstständige und kleine Teams in DACH.",
  "url": "https://codariq.de/blog",
  "publisher": {
    "@type": "Organization",
    "name": "Codariq",
    "logo": {
      "@type": "ImageObject",
      "url": "/Logo1.svg"
    }
  },
  "blogPost": [
    {
      "@type": "BlogPosting",
      "headline": "KI Projekt retten: 3 Praxisbeispiele, wie es wieder stabil läuft",
      "url": "https://codariq.de/blog/ki-projekte-retten",
      "datePublished": "2025-01-09T10:00:00+01:00",
      "author": {
        "@type": "Organization",
        "name": "Codariq"
      }
    },
    {
      "@type": "BlogPosting",
      "headline": "KI und Datenschutz in Deutschland: das Wichtigste ohne Juristendeutsch",
      "url": "https://codariq.de/blog/ki-compliance-2025",
      "datePublished": "2025-01-15T10:00:00+01:00",
      "author": {
        "@type": "Organization",
        "name": "Codariq"
      }
    },
    {
      "@type": "BlogPosting",
      "headline": "Automatisierung starten in 5 Schritten",
      "url": "https://codariq.de/blog/ki-integration-5-schritte",
      "datePublished": "2024-12-15T10:00:00+01:00",
      "author": {
        "@type": "Organization",
        "name": "Codariq"
      }
    },
    {
      "@type": "BlogPosting",
      "headline": "ROI von Prozessautomatisierung: So rechnet es sich",
      "url": "https://codariq.de/blog/automatisierung-roi-maximieren",
      "datePublished": "2024-12-15T11:00:00+01:00",
      "author": {
        "@type": "Organization",
        "name": "Codariq"
      }
    },
    {
      "@type": "BlogPosting",
      "headline": "Teams und Abläufe so vorbereiten, dass es genutzt wird",
      "url": "https://codariq.de/blog/ki-teams-vorbereiten",
      "datePublished": "2024-12-15T12:00:00+01:00",
      "author": {
        "@type": "Organization",
        "name": "Codariq"
      }
    }
  ]
}
</script>
