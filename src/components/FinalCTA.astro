---
export interface Props {
  title?: string;
  subtitle?: string;
  description?: string;
  primaryCTA?: string;
  secondaryCTA?: string;
  primaryCTALink?: string;
  secondaryCTALink?: string;
}

const {
  title = 'Starten Sie noch heute Ihre KI-Transformation',
  subtitle = 'Kostenlose Strategieberatung',
  description = 'Vereinbaren Sie Ihr kostenloses Strategiegespräch und erfahren Sie, wie KI-Automatisierung Ihr Unternehmen zum Marktführer macht.',
  primaryCTA = 'Kostenlose Strategieberatung sichern',
  secondaryCTA = 'Oder direkt anrufen: +49 XXX XXXXXXX',
  primaryCTALink = '#contact',
  secondaryCTALink = 'tel:+49XXXXXXXXX',
} = Astro.props;
---

<section id="final-cta" class="py-10 sm:py-12 bg-white">
  <div class="max-w-8xl mx-auto px-3 sm:px-4 md:px-6 lg:px-12 xl:px-16">
    <div class="max-w-4xl mx-auto">
      <!-- Header -->
      <div class="text-center mb-12">
        <h2
          class="text-3xl sm:text-4xl md:text-5xl font-bold text-gray-900 mb-4 animate-on-scroll"
        >
          {title}
        </h2>
        <p class="text-lg text-gray-600 max-w-2xl mx-auto animate-on-scroll" style="transition-delay: 0.15s">
          {description}
        </p>
        <p class="text-sm text-gray-500 mt-3 animate-on-scroll" style="transition-delay: 0.25s">
          Unverbindlich & kostenfrei • Ohne Risiko
        </p>
      </div>

      <!-- Contact Form -->
      <div
        class="bg-white rounded-xl border border-gray-200 p-6 sm:p-8 md:p-10"
      >
        <!-- Success Message -->
        <div
          id="form-success"
          role="alert"
          aria-live="polite"
          class="hidden mb-6 p-4 bg-green-50 border border-green-200 rounded-lg"
        >
          <div class="flex items-center">
            <svg
              class="w-5 h-5 text-green-500 mr-2"
              fill="currentColor"
              viewBox="0 0 20 20"
            >
              <path
                fill-rule="evenodd"
                d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                clip-rule="evenodd"></path>
            </svg>
            <div>
              <h3 class="font-semibold text-green-800">
                Vielen Dank für Ihre Anfrage!
              </h3>
              <p class="text-green-700 mt-1">
                Wir werden uns innerhalb von 24 Stunden bei Ihnen melden.
              </p>
            </div>
          </div>
        </div>

        <!-- Error Messages -->
        <div
          id="form-errors"
          role="alert"
          aria-live="polite"
          class="hidden mb-6 p-4 bg-red-50 border border-red-200 rounded-lg"
        >
          <h3 class="font-semibold text-red-800 mb-2">
            Bitte korrigieren Sie folgende Fehler:
          </h3>
          <ul id="error-list" class="list-disc list-inside text-red-700"></ul>
        </div>

        <form
          action="https://formsubmit.co/kontakt@codariq.de"
          method="POST"
          class="space-y-5"
          id="contact-form"
        >
          <fieldset>
            <legend class="sr-only">Kontaktinformationen</legend>

            <!-- FormSubmit.co Configuration -->
            <input
              type="hidden"
              name="_subject"
              value="Neue Kontaktanfrage von codariq.de"
            />
            <input
              type="hidden"
              name="_next"
              value="https://codariq.de?success=true"
            />
            <input type="hidden" name="_template" value="table" />
            <input type="hidden" name="_captcha" value="false" />

            <!-- Name Field -->
            <div class="space-y-2">
              <label for="name" class="block text-sm font-medium text-gray-700">
                Name *
              </label>
              <input
                type="text"
                id="name"
                name="name"
                required
                autocomplete="name"
                aria-describedby="name-error"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-900 focus:border-transparent transition-all"
                placeholder="Ihr vollständiger Name"
              />
              <div
                id="name-error"
                role="alert"
                aria-live="polite"
                class="text-sm text-red-600 hidden"
              >
              </div>
            </div>

            <!-- Company Field -->
            <div class="space-y-2">
              <label
                for="company"
                class="block text-sm font-medium text-gray-700"
              >
                Unternehmen *
              </label>
              <input
                type="text"
                id="company"
                name="company"
                required
                autocomplete="organization"
                aria-describedby="company-error"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-900 focus:border-transparent transition-all"
                placeholder="Ihr Unternehmensname"
              />
              <div
                id="company-error"
                role="alert"
                aria-live="polite"
                class="text-sm text-red-600 hidden"
              >
              </div>
            </div>

            <!-- Email Field -->
            <div class="space-y-2">
              <label
                for="email"
                class="block text-sm font-medium text-gray-700"
              >
                E-Mail *
              </label>
              <input
                type="email"
                id="email"
                name="email"
                required
                autocomplete="email"
                aria-describedby="email-error"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-900 focus:border-transparent transition-all"
                placeholder="ihre@email.de"
              />
              <div
                id="email-error"
                role="alert"
                aria-live="polite"
                class="text-sm text-red-600 hidden"
              >
              </div>
            </div>

            <!-- Phone Field -->
            <div class="space-y-2">
              <label
                for="phone"
                class="block text-sm font-medium text-gray-700"
              >
                Telefon
              </label>
              <input
                type="tel"
                id="phone"
                name="phone"
                autocomplete="tel"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-900 focus:border-transparent transition-all"
                placeholder="+49 XXX XXXXXXX"
              />
              <div class="text-sm text-red-600 hidden"></div>
            </div>

            <!-- Message Field -->
            <div class="space-y-2">
              <label
                for="message"
                class="block text-sm font-medium text-gray-700"
              >
                Ihre Nachricht
              </label>
              <textarea
                id="message"
                name="message"
                rows="4"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-900 focus:border-transparent transition-all resize-none"
                placeholder="Beschreiben Sie kurz Ihr Automatisierungsziel oder Ihre Herausforderung..."
              ></textarea>
            </div>

            <!-- CTA Button -->
            <div class="pt-4">
              <button
                type="submit"
                class="w-full bg-gradient-to-br from-orange-500 to-orange-700 text-white px-8 py-4 rounded-lg hover:from-orange-600 hover:to-orange-800 font-semibold text-lg focus:outline-none focus:ring-4 focus:ring-orange-200 shadow-lg cta-button"
              >
                Kostenloses Strategiegespräch vereinbaren
              </button>
            </div>

            <div class="text-center pt-2">
              <p class="text-xs text-gray-500">
                Mit dem Absenden stimmen Sie unserer
                <a href="/datenschutz" class="underline hover:text-gray-700"
                  >Datenschutzerklärung</a
                > zu.
              </p>
            </div>
          </fieldset>
        </form>
      </div>

      <!-- Blog Preview Section -->
      <div id="insights" class="mt-12">
        <div class="text-center mb-8">
          <h3 class="text-2xl font-bold text-gray-900 mb-2">
            Insights & Expertise
          </h3>
          <p class="text-gray-600">
            Aktuelle Einblicke in KI-Automatisierung und digitale Transformation
          </p>
        </div>
        
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          <!-- Blog Post 1 -->
          <article class="bg-white rounded-xl border border-gray-200 p-6 hover:shadow-lg transition-all duration-300 group">
            <div class="mb-4">
              <div class="w-full h-32 bg-gradient-to-br from-orange-100 to-orange-200 rounded-lg flex items-center justify-center mb-4">
                <svg class="w-8 h-8 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                </svg>
              </div>
              <span class="text-xs font-medium text-orange-600 bg-orange-50 px-2 py-1 rounded">
                KI-Strategie
              </span>
            </div>
            <h4 class="text-lg font-semibold text-gray-900 mb-2 group-hover:text-orange-600 transition-colors">
              5 Schritte zur erfolgreichen KI-Integration
            </h4>
            <p class="text-gray-600 text-sm leading-relaxed mb-4">
              Wie Sie KI-Technologien strategisch in Ihr Unternehmen integrieren und messbare Erfolge erzielen.
            </p>
            <div class="flex items-center justify-between text-xs text-gray-500">
              <span>8 Min. Lesezeit</span>
              <span>Neu</span>
            </div>
          </article>

          <!-- Blog Post 2 -->
          <article class="bg-white rounded-xl border border-gray-200 p-6 hover:shadow-lg transition-all duration-300 group">
            <div class="mb-4">
              <div class="w-full h-32 bg-gradient-to-br from-blue-100 to-blue-200 rounded-lg flex items-center justify-center mb-4">
                <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
              </div>
              <span class="text-xs font-medium text-blue-600 bg-blue-50 px-2 py-1 rounded">
                Automatisierung
              </span>
            </div>
            <h4 class="text-lg font-semibold text-gray-900 mb-2 group-hover:text-blue-600 transition-colors">
              ROI von Prozessautomatisierung maximieren
            </h4>
            <p class="text-gray-600 text-sm leading-relaxed mb-4">
              Praxiserprobte Methoden zur Identifikation und Umsetzung der profitabelsten Automatisierungsprojekte.
            </p>
            <div class="flex items-center justify-between text-xs text-gray-500">
              <span>12 Min. Lesezeit</span>
              <span>Beliebt</span>
            </div>
          </article>

          <!-- Blog Post 3 -->
          <article class="bg-white rounded-xl border border-gray-200 p-6 hover:shadow-lg transition-all duration-300 group md:col-span-2 lg:col-span-1">
            <div class="mb-4">
              <div class="w-full h-32 bg-gradient-to-br from-green-100 to-green-200 rounded-lg flex items-center justify-center mb-4">
                <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
                </svg>
              </div>
              <span class="text-xs font-medium text-green-600 bg-green-50 px-2 py-1 rounded">
                Change Management
              </span>
            </div>
            <h4 class="text-lg font-semibold text-gray-900 mb-2 group-hover:text-green-600 transition-colors">
              Teams erfolgreich auf KI vorbereiten
            </h4>
            <p class="text-gray-600 text-sm leading-relaxed mb-4">
              Bewährte Strategien für die Mitarbeiterschulung und den kulturellen Wandel bei der KI-Einführung.
            </p>
            <div class="flex items-center justify-between text-xs text-gray-500">
              <span>10 Min. Lesezeit</span>
              <span>Praxistipp</span>
            </div>
          </article>
        </div>
        
        <!-- Newsletter Signup -->
        <div class="mt-12">
          <div class="text-center mb-6">
            <h4 class="text-xl font-bold text-gray-900 mb-2">
              Bleiben Sie auf dem Laufenden
            </h4>
            <p class="text-gray-600 text-sm">
              Erhalten Sie wöchentlich Insights zu KI-Automatisierung und digitaler Transformation
            </p>
          </div>

          <!-- Newsletter Success Message -->
          <div
            id="newsletter-success"
            role="alert"
            aria-live="polite"
            class="hidden mb-6 p-4 bg-green-50 border border-green-200 rounded-lg"
          >
            <div class="flex items-center">
              <svg class="w-5 h-5 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
              </svg>
              <div>
                <h5 class="font-semibold text-green-800">Erfolgreich angemeldet!</h5>
                <p class="text-green-700 text-sm mt-1">Vielen Dank für Ihr Interesse. Sie erhalten eine Bestätigungs-E-Mail.</p>
              </div>
            </div>
          </div>

          <!-- Newsletter Error Messages -->
          <div
            id="newsletter-errors"
            role="alert"
            aria-live="polite"
            class="hidden mb-6 p-4 bg-red-50 border border-red-200 rounded-lg"
          >
            <h5 class="font-semibold text-red-800 mb-2">Bitte korrigieren Sie:</h5>
            <ul id="newsletter-error-list" class="list-disc list-inside text-red-700 text-sm"></ul>
          </div>

          <!-- Newsletter Form -->
          <form
            action="https://formsubmit.co/newsletter@codariq.de"
            method="POST"
            id="newsletter-form"
            class="flex flex-col sm:flex-row gap-3 max-w-md mx-auto"
          >
            <!-- FormSubmit.co Configuration -->
            <input type="hidden" name="_subject" value="Newsletter-Anmeldung von codariq.de" />
            <input type="hidden" name="_next" value="https://codariq.de?newsletter=success" />
            <input type="hidden" name="_template" value="table" />
            <input type="hidden" name="_captcha" value="false" />

            <div class="flex-1">
              <label for="newsletter-email" class="sr-only">E-Mail-Adresse</label>
              <input
                type="email"
                id="newsletter-email"
                name="email"
                required
                autocomplete="email"
                placeholder="ihre@email.de"
                aria-describedby="newsletter-email-error"
                class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all text-sm"
              />
              <div
                id="newsletter-email-error"
                role="alert"
                aria-live="polite"
                class="text-sm text-red-600 mt-1 hidden"
              ></div>
            </div>

            <button
              type="submit"
              class="bg-gradient-to-br from-orange-500 to-orange-700 text-white px-6 py-2.5 rounded-lg hover:from-orange-600 hover:to-orange-800 font-medium text-sm transition-all duration-200 shadow-md hover:shadow-lg whitespace-nowrap"
            >
              Anmelden
            </button>
          </form>

          <p class="text-xs text-gray-500 text-center mt-4">
            Kostenlos abmeldbar. Keine Spam-E-Mails. 
            <a href="/datenschutz" class="underline hover:text-gray-700">Datenschutz</a>
          </p>
      </div>
    </div>
  </div>
</section>

<style>
  /* Consistent CTA button animation */
  .cta-button {
    transform-origin: center;
    transition:
      transform 0.2s ease,
      background-color 0.2s ease;
    will-change: transform;
    backface-visibility: hidden;
  }

  .cta-button:hover {
    transform: scale(1.02);
  }
</style>

<script type="module">
  // Handle form submission and success/error messages
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('contact-form');
    const formErrors = document.getElementById('form-errors');
    const errorList = document.getElementById('error-list');
    const successDiv = document.getElementById('form-success');

    // Newsletter form elements
    const newsletterForm = document.getElementById('newsletter-form');
    const newsletterErrors = document.getElementById('newsletter-errors');
    const newsletterErrorList = document.getElementById('newsletter-error-list');
    const newsletterSuccess = document.getElementById('newsletter-success');

    // Check for success parameter in URL (from FormSubmit.co redirect)
    const urlParams = new URLSearchParams(window.location.search);
    
    // Handle contact form success
    if (urlParams.get('success') === 'true') {
      if (successDiv && form) {
        successDiv.classList.remove('hidden');
        form.style.display = 'none';

        // Clean URL to remove success parameter
        window.history.replaceState(
          {},
          document.title,
          window.location.pathname
        );

        // No automatic scrolling - user stays where they are
      }
    }

    // Handle newsletter success
    if (urlParams.get('newsletter') === 'success') {
      if (newsletterSuccess && newsletterForm) {
        newsletterSuccess.classList.remove('hidden');
        newsletterForm.style.display = 'none';

        // Clean URL to remove newsletter parameter
        window.history.replaceState(
          {},
          document.title,
          window.location.pathname
        );

        // No automatic scrolling - user stays where they are
      }
    }

    // Client-side form validation
    if (form) {
      form.addEventListener('submit', function (e) {
        // Reset error states
        formErrors.classList.add('hidden');
        errorList.innerHTML = '';

        // Get required fields
        const name = document.getElementById('name');
        const company = document.getElementById('company');
        const email = document.getElementById('email');

        let hasErrors = false;
        const errors = [];

        // Validate name
        if (!name.value.trim()) {
          errors.push('Bitte geben Sie Ihren Namen ein');
          document.getElementById('name-error').textContent =
            'Bitte geben Sie Ihren Namen ein';
          document.getElementById('name-error').classList.remove('hidden');
          hasErrors = true;
        } else {
          document.getElementById('name-error').classList.add('hidden');
        }

        // Validate company
        if (!company.value.trim()) {
          errors.push('Bitte geben Sie Ihren Unternehmensnamen ein');
          document.getElementById('company-error').textContent =
            'Bitte geben Sie Ihren Unternehmensnamen ein';
          document.getElementById('company-error').classList.remove('hidden');
          hasErrors = true;
        } else {
          document.getElementById('company-error').classList.add('hidden');
        }

        // Validate email
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!email.value.trim() || !emailRegex.test(email.value.trim())) {
          errors.push('Bitte geben Sie eine gültige E-Mail-Adresse ein');
          document.getElementById('email-error').textContent =
            'Bitte geben Sie eine gültige E-Mail-Adresse ein';
          document.getElementById('email-error').classList.remove('hidden');
          hasErrors = true;
        } else {
          document.getElementById('email-error').classList.add('hidden');
        }

        // If there are errors, prevent form submission and show error messages
        if (hasErrors) {
          e.preventDefault();
          formErrors.classList.remove('hidden');
          errors.forEach(error => {
            const li = document.createElement('li');
            li.textContent = error;
            errorList.appendChild(li);
          });
          // No automatic scrolling - user stays where they are to see their input
        }
      });
    }

    // Newsletter form validation
    if (newsletterForm) {
      newsletterForm.addEventListener('submit', function (e) {
        // Reset error states
        newsletterErrors.classList.add('hidden');
        newsletterErrorList.innerHTML = '';

        // Get email field
        const email = document.getElementById('newsletter-email');
        let hasErrors = false;
        const errors = [];

        // Validate email
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!email.value.trim() || !emailRegex.test(email.value.trim())) {
          errors.push('Bitte geben Sie eine gültige E-Mail-Adresse ein');
          document.getElementById('newsletter-email-error').textContent =
            'Bitte geben Sie eine gültige E-Mail-Adresse ein';
          document.getElementById('newsletter-email-error').classList.remove('hidden');
          hasErrors = true;
        } else {
          document.getElementById('newsletter-email-error').classList.add('hidden');
        }

        // If there are errors, prevent form submission and show error messages
        if (hasErrors) {
          e.preventDefault();
          newsletterErrors.classList.remove('hidden');
          errors.forEach(error => {
            const li = document.createElement('li');
            li.textContent = error;
            newsletterErrorList.appendChild(li);
          });
          // No automatic scrolling - user stays where they are to see their input
        }
      });
    }
  });
</script>
