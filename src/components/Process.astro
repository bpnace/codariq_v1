---
export interface Props {
  title?: string;
  subtitle?: string;
  steps?: Array<{
    number: number;
    title: string;
    description: string;
    details: string[];
    duration: string;
    result: string;
  }>;
}

const {
  title = "So läuft die Zusammenarbeit",
  subtitle = "Ein klarer Ablauf, damit du schnell Entlastung spürst. DSGVO konform und ohne Technik Chaos.",
  steps = [
    {
      number: 1,
      title: "Klarheit schaffen",
      description:
        "Wir schauen auf deinen Ablauf, wählen den besten Startpunkt und legen fest, woran du Erfolg misst.",
      details: [
        "Kurzes Gespräch zum Ziel und aktuellen Frustpunkten",
        "Wir skizzieren den Ablauf so, wie er aktuell läuft",
        "Wir checken welche Tools du bereits nutzt und wo die Daten liegen",
        "Wir definieren gemeinsam 1 bis 2 klare Messwerte, z.B. Zeitersparnis und schnellere Reaktionszeit",
        "Du bekommst einen klaren Plan zur Umsetzung, Dauer und Kostenabschätzung",
      ],
      duration: "3 bis 5 Tage",
      result: "Du weißt genau, was gebaut wird, warum es sich lohnt und wie der nächste Schritt aussieht.",
    },
    {
      number: 2,
      title: "Umsetzen und verbinden",
      description:
        "Wir bauen die Automatisierung und verbinden deine bestehenden Systeme.",
      details: [
        "Wir setzen den Workflow in n8n um und binden die benötigten Systeme an",
        "Bei Bedarf mit KI Funktionen wie Sortierung, Zusammenfassung und Antwortentwürfe.",
        "Wir testen mit echten Beispielen aus deinem Alltag und bauen Fallbacks für Sonderfälle",
        "Zugriffe, Protokolle und Datenflüsse richten wir so ein, dass es DSGVO sicher bleibt",
        "Ausführliche Dokumentation, damit du jederzeit den Überblick behältst",
      ],
      duration: "2 bis 6 Wochen",
      result: "Die Lösung läuft in deiner Umgebung und nimmt dir spürbar Arbeit ab.",
    },
    {
      number: 3,
      title: "Einführen und stabilisieren",
      description:
        "Wir bringen die Lösung in den Alltag, schulen und verbessern gezielt, bis alles zuverlässig sitzt.",
      details: [
        "Einführung in Stufen, damit der Betrieb entspannt weiterläuft",
        "Kurze Einweisung für dich und dein Team, ohne Fachchinesisch",
        "Monitoring und Feinjustierung in den ersten Wochen",
        "Anpassungen, wenn sich Prozesse oder Daten ändern",
        "Optional: laufende Betreuung, wenn du das dauerhaft auslagern willst",
      ],
      duration: "4 bis 12 Wochen Begleitung",
      result: "Stabile Automatisierung, die dein Team wirklich nutzt und die messbar entlastet.",
    },
  ],
} = Astro.props;
---

<section id="process" class="py-12 sm:py-16 md:py-20 bg-white relative overflow-hidden">
  <div
    class="max-w-8xl mx-auto px-3 sm:px-4 md:px-6 lg:px-12 xl:px-16 relative"
  >
    <!-- Section Header -->
    <div class="text-center mb-10 sm:mb-12 md:mb-16 px-4">
      <h2
        class="section-title mb-3 sm:mb-4 animate-on-scroll"
      >
        {title}
      </h2>
      <p
        class="section-subtitle max-w-3xl mx-auto animate-on-scroll"
        style="transition-delay: 0.15s"
      >
        {subtitle}
      </p>
    </div>

    <!-- Process Steps -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6">
      {/* Desktop: Vertical Slideshow (hidden on mobile) */}
      <div class="hidden lg:flex gap-8 items-stretch">
        {/* Left: Step Navigation */}
        <div class="w-80 flex-shrink-0 flex flex-col justify-center gap-6 min-h-[560px]">
          {
            steps.map((step, index) => (
              <button
                class="step-nav-btn w-full p-4 text-left flex items-center gap-4 bg-white rounded-xl border-2 border-gray-200 transition-all duration-300 hover:border-gray-300 hover:shadow-sm"
                data-step-nav={index}
                data-active={index === 0 ? "true" : "false"}
              >
                {/* Step Number */}
                <div
                  class="w-12 h-12 rounded-xl flex items-center justify-center font-bold text-xl shadow-lg flex-shrink-0 transition-all duration-300"
                  data-step-badge={index}
                  style={index === 0 ? "background: linear-gradient(to bottom right, rgb(17 24 39), rgb(31 41 55)); color: white;" : "background-color: rgb(243 244 246); color: rgb(107 114 128);"}
                >
                  {step.number}
                </div>

                {/* Title */}
                <div class="flex-1 min-w-0">
                  <h3
                    class="text-lg font-black leading-tight transition-colors duration-300"
                    data-step-title={index}
                    style={index === 0 ? "color: rgb(17 24 39);" : "color: rgb(107 114 128);"}
                  >
                    {step.title}
                  </h3>
                </div>
              </button>
            ))
          }
        </div>

        {/* Right: Content Area */}
        <div class="flex-1 bg-white rounded-xl border-2 border-gray-200 shadow-xl relative min-h-[560px] overflow-hidden">
          {
            steps.map((step, index) => (
              <div
                class="step-content absolute top-0 left-0 right-0 p-6 transition-opacity duration-300"
                data-step-content={index}
                style={index === 0 ? "opacity: 1; pointer-events: auto;" : "opacity: 0; pointer-events: none;"}
              >
                {/* Header */}
                <div class="mb-4">
                  <h3 class="content-title mb-1.5">
                    {step.title}
                  </h3>
                  <div class="inline-flex items-center gap-1.5 bg-gray-100 text-gray-700 px-2.5 py-1 rounded-lg text-xs font-semibold">
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    {step.duration}
                  </div>
                </div>

                {/* Description */}
                <p class="body-muted mb-4">
                  {step.description}
                </p>

                {/* Details */}
                <div class="mb-4">
                  <h4 class="micro-title mb-3">Was ist enthalten:</h4>
                  <div class="grid grid-cols-1 xl:grid-cols-2 gap-3">
                    {step.details.map((detail) => (
                      <div class="flex items-start gap-2.5 bg-gray-50 rounded-lg p-3 border border-gray-200">
                        <div class="w-1.5 h-1.5 bg-orange-500 rounded-full flex-shrink-0 mt-1.5" />
                        <span class="text-sm sm:text-base font-medium text-gray-700 leading-snug">
                          {detail}
                        </span>
                      </div>
                    ))}
                  </div>
                </div>

                {/* Result */}
                <div class="bg-gray-100 rounded-lg p-3 border border-gray-200">
                  <div class="flex items-start gap-2">
                    <svg class="w-4 h-4 text-orange-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <div class="flex-1">
                      <span class="text-sm sm:text-base font-black text-gray-900 block mb-1">
                        Ergebnis:
                      </span>
                      <p class="text-sm sm:text-base font-medium text-gray-700 leading-relaxed">
                        {step.result}
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            ))
          }
        </div>
      </div>

      {/* Mobile: Vertical Slideshow (shown only on mobile) */}
      <div class="lg:hidden flex flex-col gap-6">
        {/* Step Navigation */}
        <div class="flex overflow-x-auto gap-2 pb-2 -mx-4 px-4 snap-x snap-mandatory scrollbar-hide">
          {
            steps.map((step, index) => (
              <button
                class="step-nav-btn-mobile flex-shrink-0 p-3 text-left flex items-center gap-3 bg-white rounded-xl border-2 border-gray-200 transition-all duration-300 snap-start min-w-[280px]"
                data-step-nav-mobile={index}
                data-active-mobile={index === 0 ? "true" : "false"}
              >
                {/* Step Number */}
                <div
                  class="w-10 h-10 rounded-xl flex items-center justify-center font-bold text-lg shadow-lg flex-shrink-0 transition-all duration-300"
                  data-step-badge-mobile={index}
                  style={index === 0 ? "background: linear-gradient(to bottom right, rgb(17 24 39), rgb(31 41 55)); color: white;" : "background-color: rgb(243 244 246); color: rgb(107 114 128);"}
                >
                  {step.number}
                </div>

                {/* Title */}
                <div class="flex-1 min-w-0">
                  <h3
                    class="text-base font-black leading-tight transition-colors duration-300"
                    data-step-title-mobile={index}
                    style={index === 0 ? "color: rgb(17 24 39);" : "color: rgb(107 114 128);"}
                  >
                    {step.title}
                  </h3>
                </div>
              </button>
            ))
          }
        </div>

        {/* Content Area */}
        <div class="bg-white rounded-xl border-2 border-gray-200 shadow-xl relative transition-all duration-300" style="min-height: 440px;">
          {
            steps.map((step, index) => (
              <div
                class="step-content-mobile absolute top-0 left-0 right-0 p-5 transition-opacity duration-300"
                data-step-content-mobile={index}
                style={index === 0 ? "opacity: 1; pointer-events: auto;" : "opacity: 0; pointer-events: none;"}
              >
                {/* Header */}
                <div class="mb-3">
                  <h3 class="text-lg font-black text-gray-900 mb-1.5">
                    {step.title}
                  </h3>
                  <div class="inline-flex items-center gap-1.5 bg-gray-100 text-gray-700 px-2.5 py-1 rounded-lg text-xs font-semibold">
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    {step.duration}
                  </div>
                </div>

                {/* Description */}
                <p class="body-muted mb-3">
                  {step.description}
                </p>

                {/* Details */}
                <div class="mb-3">
                  <h4 class="micro-title mb-2.5">Was ist enthalten:</h4>
                  <div class="space-y-2">
                    {step.details.map((detail) => (
                      <div class="flex items-start gap-2.5 bg-gray-50 rounded-lg p-3 border border-gray-200">
                        <div class="w-1.5 h-1.5 bg-orange-500 rounded-full flex-shrink-0 mt-1.5" />
                        <span class="text-sm sm:text-base font-medium text-gray-700 leading-snug">
                          {detail}
                        </span>
                      </div>
                    ))}
                  </div>
                </div>

                {/* Result */}
                <div class="bg-gray-100 rounded-lg p-3 border border-gray-200">
                  <div class="flex items-start gap-2">
                    <svg class="w-4 h-4 text-orange-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <div class="flex-1">
                      <span class="text-sm sm:text-base font-black text-gray-900 block mb-1">
                        Ergebnis:
                      </span>
                      <p class="text-sm sm:text-base font-medium text-gray-700 leading-relaxed">
                        {step.result}
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            ))
          }
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Desktop: Step navigation slideshow
    const navButtons = document.querySelectorAll<HTMLElement>("[data-step-nav]");

    navButtons.forEach((button) => {
      button.addEventListener("click", function (this: HTMLElement) {
        const clickedIndex = this.getAttribute("data-step-nav");

        // Update all nav buttons and content
        navButtons.forEach((navBtn, i) => {
          const index = i.toString();
          const isActive = index === clickedIndex;
          const badge = document.querySelector<HTMLElement>(`[data-step-badge="${index}"]`);
          const title = document.querySelector<HTMLElement>(`[data-step-title="${index}"]`);
          const content = document.querySelector<HTMLElement>(`[data-step-content="${index}"]`);

          // Update nav button state
          navBtn.setAttribute("data-active", isActive ? "true" : "false");

          // Update badge
          if (badge) {
            if (isActive) {
              badge.style.background = "linear-gradient(to bottom right, rgb(17 24 39), rgb(31 41 55))";
              badge.style.color = "white";
            } else {
              badge.style.background = "rgb(243 244 246)";
              badge.style.color = "rgb(107 114 128)";
            }
          }

          // Update title color
          if (title) {
            title.style.color = isActive ? "rgb(17 24 39)" : "rgb(107 114 128)";
          }

          // Show/hide content with smooth fade
          if (content) {
            if (isActive) {
              content.style.opacity = "1";
              content.style.pointerEvents = "auto";
            } else {
              content.style.opacity = "0";
              content.style.pointerEvents = "none";
            }
          }
        });
      });
    });

    // Mobile: Step navigation slideshow
    const navButtonsMobile = document.querySelectorAll<HTMLElement>("[data-step-nav-mobile]");
    const mobileContainer = document.querySelector<HTMLElement>(".step-content-mobile")?.parentElement;

    // Function to update mobile container height
    function updateMobileContainerHeight() {
      if (!mobileContainer) return;

      const activeContent = mobileContainer.querySelector<HTMLElement>('[data-step-content-mobile][style*="opacity: 1"]');
      if (activeContent) {
        const contentHeight = activeContent.scrollHeight;
        mobileContainer.style.height = `${contentHeight}px`;
      }
    }

    // Set initial height
    updateMobileContainerHeight();

    navButtonsMobile.forEach((button) => {
      button.addEventListener("click", function (this: HTMLElement) {
        const clickedIndex = this.getAttribute("data-step-nav-mobile");

        // Update all mobile nav buttons and content
        navButtonsMobile.forEach((navBtn, i) => {
          const index = i.toString();
          const isActive = index === clickedIndex;
          const badge = document.querySelector<HTMLElement>(`[data-step-badge-mobile="${index}"]`);
          const title = document.querySelector<HTMLElement>(`[data-step-title-mobile="${index}"]`);
          const content = document.querySelector<HTMLElement>(`[data-step-content-mobile="${index}"]`);

          // Update nav button state
          navBtn.setAttribute("data-active-mobile", isActive ? "true" : "false");

          // Update badge
          if (badge) {
            if (isActive) {
              badge.style.background = "linear-gradient(to bottom right, rgb(17 24 39), rgb(31 41 55))";
              badge.style.color = "white";
            } else {
              badge.style.background = "rgb(243 244 246)";
              badge.style.color = "rgb(107 114 128)";
            }
          }

          // Update title color
          if (title) {
            title.style.color = isActive ? "rgb(17 24 39)" : "rgb(107 114 128)";
          }

          // Show/hide content with smooth fade
          if (content) {
            if (isActive) {
              content.style.opacity = "1";
              content.style.pointerEvents = "auto";
            } else {
              content.style.opacity = "0";
              content.style.pointerEvents = "none";
            }
          }
        });

        // Update container height after content change
        setTimeout(updateMobileContainerHeight, 50);
      });
    });
  });
</script>

<style>
  /* Hide scrollbar for mobile navigation */
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }

  /* Consistent CTA button animation */
  .cta-button {
    transform-origin: center;
    transition:
      transform 0.2s ease,
      background-color 0.2s ease;
    will-change: transform;
    backface-visibility: hidden;
  }

  .cta-button:hover {
    transform: scale(1.02);
  }
</style>
